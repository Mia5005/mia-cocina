<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Cocinamia - Men√∫</title>

  <!-- üì± Meta responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- üîπ Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- üé® Estilos personalizados -->
  <style>
    body {
      background-color: #fffdf7;
      padding: 1rem;
    }

    h1 {
      font-weight: 700;
      margin-bottom: 1.5rem;
    }

    .plato-img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
    }

    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
    }

    .card-body h5 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .form-control {
      border-radius: 10px;
    }

    .btn-primary {
      background-color: #ff8c00;
      border: none;
    }

    .btn-primary:hover {
      background-color: #e67e00;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
      }

      .plato-img {
        height: 120px;
      }

      .card-body h5 {
        font-size: 1rem;
      }

      .btn {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 576px) {
      .col-md-3 {
        flex: 0 0 100%;
        max-width: 100%;
      }

      .card {
        margin-bottom: 1rem;
      }
    }
  </style>
</head>

<body class="container">
  <h1 class="text-center mb-4">üçΩÔ∏è Men√∫ - Cocinamia</h1>

  <!-- üîπ ID de mesa -->
  <div class="mb-4">
    <label class="form-label fw-semibold">ID de mesa</label>
    <input id="mesa_id" class="form-control" placeholder="Ej: Mesa 3">
  </div>

  <!-- üîπ Lista del men√∫ -->
  <div class="row g-3">
    {% for plato in menu %}
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <div class="card p-2 h-100">
          <img src="{{ plato.imagen }}" class="plato-img card-img-top" alt="{{ plato.nombre }}">
          <div class="card-body text-center d-flex flex-column justify-content-between">
            <div>
              <h5>{{ plato.nombre }}</h5>
              <p class="text-success fw-bold mb-1">${{ plato.precio }}</p>
              <p class="small text-muted">Disponibles: {{ plato.inventario }}</p>
            </div>

            {% if plato.inventario > 0 %}
              <div class="d-flex justify-content-center mt-2">
                <input id="cant_{{ plato.id }}" type="number" min="1" max="{{ plato.inventario }}" value="1"
                       class="form-control form-control-sm me-2 text-center" style="width:70px">
                <button class="btn btn-primary btn-sm"
                        onclick="agregar({{ plato.id }}, '{{ plato.nombre }}', {{ plato.precio }})">
                        Agregar
                </button>
              </div>
            {% else %}
              <button class="btn btn-secondary btn-sm w-100 mt-2" disabled>Agotado</button>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <hr class="my-4">

  <!-- üîπ Pedido actual -->
  <h4 class="fw-bold text-center">üßæ Pedido Actual</h4>
  <ul id="lista" class="list-group mb-3"></ul>
  <h5 class="text-center">Total: $<span id="total">0.00</span></h5>

  <button class="btn btn-success w-100 mt-3" onclick="enviarPedido()">Enviar Pedido</button>

  <div class="text-center mt-4">
    <a href="{{ url_for('login') }}" class="btn btn-outline-dark">Entrar al panel</a>
  </div>

  <!-- üîπ Scripts -->
  <script>
    let pedido = [];

    function agregar(id, nombre, precio) {
      const cantidad = parseInt(document.getElementById('cant_' + id).value) || 1;
      const e = pedido.find(x => x.id === id);
      if (e) e.cantidad += cantidad;
      else pedido.push({ id, nombre, precio, cantidad });
      render();
    }

    function render() {
      const lista = document.getElementById('lista');
      lista.innerHTML = '';
      let total = 0;
      pedido.forEach(p => {
        total += p.precio * p.cantidad;
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `${p.nombre} √ó${p.cantidad} <span>$${(p.precio * p.cantidad).toFixed(2)}</span>`;
        lista.appendChild(li);
      });
      document.getElementById('total').innerText = total.toFixed(2);
    }

    async function enviarPedido() {
      const mesa = document.getElementById('mesa_id').value.trim();
      if (!mesa) return alert('‚ö†Ô∏è Ingresa el ID de mesa');
      if (pedido.length === 0) return alert('‚ö†Ô∏è No hay platos en el pedido');

      const res = await fetch('/pedido', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ mesa_id: mesa, items: pedido })
      });

      const data = await res.json();
      if (data.status === 'ok') {
        alert('‚úÖ Pedido enviado correctamente');
        pedido = [];
        render();
        document.getElementById('mesa_id').value = '';
        location.reload();
      } else {
        alert('‚ùå Error: ' + data.message);
      }
    }
  </script>
</body>
</html>
